<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cheeky Radio - Internet Radio Player</title>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #d4d4d4;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ===================== HEADER ===================== */
        header {
            padding: 15px 30px;
            background: rgba(42, 42, 42, 0.6);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 107, 53, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .logo {
            font-size: 1.8em;
            font-weight: 900;
            letter-spacing: -2px;
            background: linear-gradient(135deg, #d4d4d4 0%, #a8a8a8 50%, #ff6b35 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: lowercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logo:hover {
            letter-spacing: 0px;
        }

        .logo::after {
            content: '';
            display: inline-block;
            margin-left: 8px;
            font-size: 0.5em;
            color: #ff6b35;
        }

        .header-center {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 30px;
        }

        .search-bar {
            width: 100%;
            max-width: 400px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 25px;
            color: #d4d4d4;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .search-bar::placeholder {
            color: #a8a8a8;
        }

        .search-bar:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 107, 53, 0.6);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.2);
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .icon-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            color: #ff6b35;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1em;
        }

        .icon-btn:hover {
            background: rgba(255, 107, 53, 0.2);
            transform: scale(1.1);
        }

        /* ===================== MAIN CONTENT ===================== */
        main {
            flex: 1;
            padding: 15px 30px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Split Screen Layout */
        .split-container {
            display: flex;
            gap: 15px;
            flex-shrink: 0;
            align-items: stretch;
        }

        /* Hero Player */
        .hero-player {
            background: linear-gradient(135deg, rgba(42, 42, 42, 0.8) 0%, rgba(31, 31, 31, 0.9) 100%);
            border-radius: 15px;
            padding: 15px 25px;
            border: 2px solid rgba(255, 107, 53, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            flex: 1;
        }

        /* Device List Panel */
        .device-list-panel {
            background: linear-gradient(135deg, rgba(42, 42, 42, 0.8) 0%, rgba(31, 31, 31, 0.9) 100%);
            border-radius: 15px;
            padding: 15px 20px;
            border: 2px solid rgba(255, 107, 53, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .device-list-panel h3 {
            margin: 0;
            font-size: 1.1em;
            color: #ff6b35;
            font-weight: 700;
        }

        .device-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .device-group-title {
            font-size: 0.85em;
            color: #a8a8a8;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .device-item {
            padding: 12px 15px;
            background: rgba(64, 64, 64, 0.5);
            border: 1.5px solid rgba(255, 107, 53, 0.2);
            border-radius: 8px;
            color: #d4d4d4;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .device-item:hover {
            background: rgba(64, 64, 64, 0.8);
            border-color: #ff6b35;
            transform: translateX(3px);
        }

        .device-item.active {
            background: rgba(255, 107, 53, 0.2);
            border-color: #ff6b35;
            color: #ff6b35;
            font-weight: 600;
            box-shadow: 0 0 12px rgba(255, 107, 53, 0.3);
        }

        .device-icon {
            font-size: 1.2em;
        }

        .device-name {
            flex: 1;
        }

        .no-devices-msg {
            padding: 12px;
            color: #a8a8a8;
            font-size: 0.85em;
            font-style: italic;
            text-align: center;
        }

        .hero-player::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(255, 107, 53, 0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .now-playing-label {
            color: #ff6b35;
            font-size: 0.75em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .track-info {
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .track-title {
            font-size: 1.3em;
            font-weight: 900;
            color: #d4d4d4;
            margin-bottom: 2px;
            line-height: 1.2;
        }

        .track-artist {
            font-size: 0.85em;
            color: #a8a8a8;
            font-weight: 300;
        }

        .station-badge {
            display: inline-block;
            padding: 5px 15px;
            background: rgba(255, 107, 53, 0.15);
            border: 1px solid rgba(255, 107, 53, 0.4);
            border-radius: 15px;
            color: #ff6b35;
            font-size: 0.8em;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Progress Bar */
        .progress-section {
            margin: 8px 0;
            position: relative;
            z-index: 1;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35 0%, #ff8c5a 100%);
            width: 0%;
            border-radius: 3px;
            position: relative;
            transition: width 0.1s linear;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 14px;
            height: 14px;
            background: #ff6b35;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.8);
        }

        .time-stamps {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #a8a8a8;
        }

        /* Player Controls */
        .player-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
            position: relative;
            z-index: 1;
        }

        .control-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(212, 212, 212, 0.1);
            border: 2px solid rgba(212, 212, 212, 0.3);
            color: #d4d4d4;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }

        .control-btn:hover {
            background: rgba(212, 212, 212, 0.2);
            border-color: #d4d4d4;
            transform: scale(1.05);
        }

        .control-btn.play {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff6b35 0%, #ff8c5a 100%);
            border: none;
            color: #2a2a2a;
            font-size: 1.2em;
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
        }

        .control-btn.play:hover {
            box-shadow: 0 12px 30px rgba(255, 107, 53, 0.6);
            transform: scale(1.1);
        }

        /* Volume Control */
        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 6px;
            justify-content: center;
            position: relative;
            z-index: 1;
            font-size: 0.85em;
        }

        .volume-icon {
            color: #ff6b35;
            font-size: 0.9em;
        }

        .volume-slider {
            width: 100px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }

        .volume-fill {
            height: 100%;
            width: 70%;
            background: linear-gradient(90deg, #ff6b35 0%, #ff8c5a 100%);
            border-radius: 2px;
        }

        /* Receiver Quick Select */
        .receiver-quick-select {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .receiver-icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 107, 53, 0.2);
            border: 1.5px solid #ff6b35;
            color: #ff6b35;
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .receiver-icon-btn:hover {
            background: rgba(255, 107, 53, 0.3);
            transform: scale(1.05);
        }

        .receiver-dropdown {
            position: absolute;
            bottom: 50px;
            right: 0;
            background: rgba(42, 42, 42, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 8px;
            min-width: 200px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .dropdown-item {
            padding: 10px 12px;
            background: rgba(64, 64, 64, 0.5);
            border: 1px solid transparent;
            border-radius: 6px;
            color: #d4d4d4;
            text-align: left;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dropdown-item:hover {
            background: rgba(64, 64, 64, 0.8);
            border-color: #ff6b35;
        }

        .dropdown-item.active {
            background: rgba(255, 107, 53, 0.3);
            border-color: #ff6b35;
            color: #ff6b35;
            font-weight: 600;
        }

        /* Settings Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal {
            background: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%);
            border: 1px solid rgba(255, 107, 53, 0.2);
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 107, 53, 0.2);
            position: sticky;
            top: 0;
            background: rgba(42, 42, 42, 0.5);
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.3em;
            color: #ff6b35;
        }

        .modal-close {
            background: none;
            border: none;
            color: #a8a8a8;
            font-size: 1.5em;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: #ff6b35;
        }

        .modal-body {
            padding: 20px;
        }

        .settings-section {
            margin-bottom: 25px;
        }

        .settings-section h3 {
            margin: 0 0 15px 0;
            font-size: 1em;
            color: #ff6b35;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .receiver-selection {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .receiver-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .receiver-group h4 {
            margin: 0;
            font-size: 0.9em;
            color: #d4d4d4;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.8;
        }

        .receiver-btn {
            padding: 12px;
            background: rgba(64, 64, 64, 0.5);
            border: 1.5px solid rgba(255, 107, 53, 0.2);
            border-radius: 8px;
            color: #d4d4d4;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95em;
            text-align: left;
        }

        .receiver-btn:hover {
            background: rgba(64, 64, 64, 0.8);
            border-color: #ff6b35;
        }

        .receiver-btn.active {
            background: rgba(255, 107, 53, 0.2);
            border-color: #ff6b35;
            color: #ff6b35;
            font-weight: 600;
            box-shadow: 0 0 12px rgba(255, 107, 53, 0.3);
        }

        .scan-btn {
            background: rgba(255, 107, 53, 0.1);
            border-color: rgba(255, 107, 53, 0.3);
        }

        .scan-btn:hover {
            background: rgba(255, 107, 53, 0.2);
        }

        .no-devices {
            padding: 12px;
            color: #a8a8a8;
            font-size: 0.85em;
            font-style: italic;
            text-align: center;
        }

        /* Station Grid */
        .stations-section {
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        .section-header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-shrink: 0;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: 700;
            color: #d4d4d4;
            position: relative;
            padding-left: 12px;
            margin-bottom: 0;
        }

        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 100%;
            background: linear-gradient(180deg, #ff6b35 0%, #ff8c5a 100%);
            border-radius: 2px;
        }

        /* Tabs */
        .tabs-container {
            display: flex;
            gap: 5px;
            overflow-x: auto;
            overflow-y: hidden;
            flex-shrink: 0;
            padding-bottom: 5px;
            scroll-behavior: smooth;
        }

        .tabs-container::-webkit-scrollbar {
            height: 4px;
        }

        .tabs-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }

        .tabs-container::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 53, 0.3);
            border-radius: 2px;
        }

        .tabs-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 107, 53, 0.5);
        }

        .tab-btn {
            padding: 6px 12px;
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            color: #a8a8a8;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .tab-btn:hover {
            background: rgba(255, 107, 53, 0.2);
            border-color: rgba(255, 107, 53, 0.5);
            color: #d4d4d4;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #ff6b35 0%, #ff8c5a 100%);
            color: #2a2a2a;
            border-color: #ff6b35;
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-label {
            color: #a8a8a8;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 107, 53, 0.2);
            border-radius: 6px;
            color: #d4d4d4;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:hover {
            border-color: rgba(255, 107, 53, 0.5);
            background: rgba(255, 255, 255, 0.12);
        }

        .filter-select:focus {
            outline: none;
            border-color: #ff6b35;
            background: rgba(255, 255, 255, 0.15);
        }

        .search-input {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 8px;
            color: #d4d4d4;
            font-size: 0.9em;
        }

        .search-input::placeholder {
            color: #a8a8a8;
        }

        .search-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: #ff6b35;
        }

        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            gap: 15px;
        }

        .spinner {
            font-size: 3em;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .pulsing {
            animation: pulse 2s ease-in-out infinite;
            font-size: 3em;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; transform: scale(0.95); }
            50% { opacity: 1; transform: scale(1); }
        }

        .station-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            flex: 1;
            overflow: hidden;
            align-content: start;
        }

        .station-card {
            background: linear-gradient(135deg, rgba(42, 42, 42, 0.6) 0%, rgba(31, 31, 31, 0.8) 100%);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 107, 53, 0.15);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            height: fit-content;
        }

        .station-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.05) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .station-card:hover {
            border-color: rgba(255, 107, 53, 0.4);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.2);
        }

        .station-card:hover::before {
            opacity: 1;
        }

        .station-icon {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 12px;
            background: linear-gradient(135deg, #ff6b35 0%, #ff8c5a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            margin-bottom: 12px;
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
            overflow: hidden;
            object-fit: cover;
        }

        .station-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .station-icon-fallback {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff6b35 0%, #ff8c5a 100%);
            font-size: 2em;
        }

        .station-name {
            font-size: 1.1em;
            font-weight: 700;
            color: #d4d4d4;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .station-genre {
            color: #a8a8a8;
            font-size: 0.8em;
        }

        .station-listeners {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #ff6b35;
            font-size: 0.75em;
            font-weight: 600;
        }

        .station-action-btn {
            margin-top: 10px;
            padding: 8px;
            background: rgba(255, 107, 53, 0.2);
            border: 1px solid rgba(255, 107, 53, 0.4);
            color: #ff6b35;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }

        .station-action-btn:hover {
            background: rgba(255, 107, 53, 0.3);
            border-color: #ff6b35;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            gap: 15px;
            color: #a8a8a8;
        }

        .empty-state-icon {
            font-size: 4em;
            opacity: 0.5;
        }

        .empty-state-text {
            text-align: center;
            max-width: 400px;
        }

        /* ===================== FOOTER ===================== */
        footer {
            background: rgba(42, 42, 42, 0.8);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 107, 53, 0.2);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .footer-left {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .footer-link {
            color: #a8a8a8;
            text-decoration: none;
            font-size: 0.85em;
            transition: color 0.3s ease;
        }

        .footer-link:hover {
            color: #ff6b35;
        }

        .footer-right {
            color: #a8a8a8;
            font-size: 0.85em;
        }

        /* Player Disabled State */
        .player-disabled {
            opacity: 0.5;
            pointer-events: none;
            user-select: none;
        }

        .player-disabled::after {
            content: '‚ö† No output devices available. Open Settings to connect a speaker.';
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 107, 53, 0.9);
            color: #1a1a1a;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 600;
            white-space: nowrap;
            z-index: 10;
        }

        /* Notification Balloons */
        .notifications-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
            pointer-events: none;
        }

        .notification {
            background: linear-gradient(135deg, rgba(42, 42, 42, 0.95) 0%, rgba(31, 31, 31, 0.98) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 10px;
            padding: 12px 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            gap: 12px;
            pointer-events: auto;
            animation: slideIn 0.3s ease-out;
            min-width: 280px;
        }

        .notification.removing {
            animation: slideOut 0.3s ease-in forwards;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .notification-icon {
            font-size: 1.5em;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .notification-title {
            font-size: 0.9em;
            font-weight: 700;
            color: #ff6b35;
        }

        .notification-message {
            font-size: 0.85em;
            color: #d4d4d4;
            line-height: 1.3;
        }

        .notification-close {
            background: none;
            border: none;
            color: #a8a8a8;
            font-size: 1.2em;
            cursor: pointer;
            transition: color 0.2s ease;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification-close:hover {
            color: #ff6b35;
        }

        .notification.success {
            border-color: rgba(76, 175, 80, 0.4);
        }

        .notification.success .notification-title {
            color: #4CAF50;
        }

        .notification.info {
            border-color: rgba(33, 150, 243, 0.4);
        }

        .notification.info .notification-title {
            color: #2196F3;
        }

        .notification.warning {
            border-color: rgba(255, 152, 0, 0.4);
        }

        .notification.warning .notification-title {
            color: #FF9800;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .station-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }

            /* Stack split-screen on tablet */
            .split-container {
                flex-direction: column;
            }
        }

        @media (max-width: 768px) {
            header {
                padding: 12px 20px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .header-center {
                order: 3;
                width: 100%;
                margin: 10px 0 0 0;
            }

            .search-bar {
                max-width: 100%;
            }

            .logo {
                font-size: 1.5em;
            }

            .track-title {
                font-size: 1.5em;
            }

            main {
                padding: 15px 20px;
            }

            .station-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 12px;
            }

            .control-btn {
                width: 40px;
                height: 40px;
            }

            .control-btn.play {
                width: 55px;
                height: 55px;
            }

            footer {
                flex-direction: column;
                gap: 10px;
                padding: 12px 20px;
                text-align: center;
            }

            .footer-left {
                flex-direction: column;
                gap: 10px;
            }

            /* Notification adjustments for mobile */
            .notifications-container {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }

            .notification {
                min-width: auto;
            }

            .notification-title {
                font-size: 0.85em;
            }

            .notification-message {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">cheeky</div>
        <div class="header-right">
            <button class="icon-btn" title="Settings" @click="showSettingsModal = true">‚öôÔ∏è</button>
        </div>
    </header>

    <!-- Settings Modal -->
    <div class="modal-overlay" x-show="showSettingsModal" @click="showSettingsModal = false" style="display: none;">
        <div class="modal" @click.stop>
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" @click="showSettingsModal = false">‚úï</button>
            </div>
            <div class="modal-body">
                <!-- Audio Output Receivers -->
                <div class="settings-section">
                    <h3>Audio Output</h3>
                    <div class="receiver-selection">
                        <div class="receiver-group">
                            <h4>Local Speaker</h4>
                            <button class="receiver-btn" :class="selectedReceiver?.type === 'local' && 'active'"
                                @click="selectReceiver({type: 'local', device: null})" title="Play on this device">
                                üîä This Device
                            </button>
                        </div>
                        <div class="receiver-group">
                            <h4>Bluetooth Speakers</h4>
                            <div x-show="bluetoothDevices.length === 0" class="no-devices">No Bluetooth devices found</div>
                            <template x-for="device in bluetoothDevices" :key="device.mac">
                                <button class="receiver-btn" :class="selectedReceiver?.type === 'bluetooth' && selectedReceiver?.device?.mac === device.mac && 'active'"
                                    @click="selectReceiver({type: 'bluetooth', device: device})" :title="device.name">
                                    üì± <span x-text="device.name"></span>
                                </button>
                            </template>
                            <button class="receiver-btn scan-btn" @click="scanBluetoothDevices()" title="Scan for devices">
                                üîç Scan for Devices
                            </button>
                        </div>
                        <div class="receiver-group">
                            <h4>Airplay Receivers</h4>
                            <div x-show="airplayDevices.length === 0" class="no-devices">No Airplay devices found</div>
                            <template x-for="device in airplayDevices" :key="device.address">
                                <button class="receiver-btn" :class="selectedReceiver?.type === 'airplay' && selectedReceiver?.device?.address === device.address && 'active'"
                                    @click="selectReceiver({type: 'airplay', device: device})" :title="device.name">
                                    üéµ <span x-text="device.name"></span>
                                </button>
                            </template>
                            <button class="receiver-btn scan-btn" @click="discoverAirplayDevices()" title="Discover devices">
                                üîç Discover Airplay Devices
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main x-data="radioApp()" @keydown.escape="searchQuery = ''; loadPopular()">
        <!-- Notification Balloons Container -->
        <div class="notifications-container">
            <template x-for="notification in notifications" :key="notification.id">
                <div class="notification" :class="[notification.type, notification.removing && 'removing']">
                    <div class="notification-icon" x-text="notification.icon"></div>
                    <div class="notification-content">
                        <div class="notification-title" x-text="notification.title"></div>
                        <div class="notification-message" x-text="notification.message"></div>
                    </div>
                    <button class="notification-close" @click="removeNotification(notification.id)" title="Dismiss">‚úï</button>
                </div>
            </template>
        </div>

        <!-- Split Screen: Player + Device List -->
        <div class="split-container">
            <!-- Hero Player -->
            <div class="hero-player" :class="{'player-disabled': !hasOutputDevices()}">
                <div class="now-playing-label">Now Playing</div>
                <div class="track-info">
                    <h1 class="track-title" x-text="currentStation?.name || 'No Station Selected'">No Station Selected</h1>
                    <p class="track-artist" x-text="isPlaying ? 'Currently playing...' : 'Select a station to start'"></p>
                    <span class="station-badge" x-show="currentStation" x-text="'üéµ ' + (currentStation?.country || 'Unknown')"></span>
                </div>

                <div class="progress-section">
                    <div class="progress-bar" @click="seekPlayback($event)">
                        <div class="progress-fill" :style="{ width: playProgress + '%' }"></div>
                    </div>
                    <div class="time-stamps">
                        <span x-text="formatTime(playbackTime)">0:00</span>
                        <span x-text="formatTime(playbackDuration)">0:00</span>
                    </div>
                </div>

                <div class="player-controls">
                    <button class="control-btn" @click="previousStation()" title="Previous">‚èÆ</button>
                    <button class="control-btn play" @click="togglePlay()" :title="isPlaying ? 'Pause' : 'Play'" x-text="isPlaying ? '‚è∏' : '‚ñ∂'">‚ñ∂</button>
                    <button class="control-btn" @click="nextStation()" title="Next">‚è≠</button>
                    <button class="control-btn" @click="toggleFavorite(currentStation)" :title="isFavorite ? 'Remove from favorites' : 'Add to favorites'" x-text="isFavorite ? '‚ù§Ô∏è' : 'ü§ç'">ü§ç</button>
                </div>

                <div class="volume-control">
                    <span class="volume-icon">üîä</span>
                    <div class="volume-slider" @click="setVolume($event)">
                        <div class="volume-fill" :style="{ width: volume + '%' }"></div>
                    </div>
                    <span style="color: #a8a8a8; font-size: 0.85em;" x-text="volume + '%'">70%</span>
                </div>

                <!-- Quick Receiver Selector -->
                <div class="receiver-quick-select">
                    <button class="receiver-icon-btn" @click="showReceiverDropdown = !showReceiverDropdown" title="Select audio output">
                        <span x-show="selectedReceiver?.type === 'local'">üîä</span>
                        <span x-show="selectedReceiver?.type === 'bluetooth'">üì±</span>
                        <span x-show="selectedReceiver?.type === 'airplay'">üéµ</span>
                    </button>
                    <div class="receiver-dropdown" x-show="showReceiverDropdown" @click.away="showReceiverDropdown = false">
                        <button class="dropdown-item" :class="selectedReceiver?.type === 'local' && 'active'"
                            @click="selectReceiver({type: 'local', device: null}); showReceiverDropdown = false"
                            title="Play on this device">
                            üîä This Device
                        </button>
                        <template x-for="device in bluetoothDevices" :key="device.mac">
                            <button class="dropdown-item" :class="selectedReceiver?.type === 'bluetooth' && selectedReceiver?.device?.mac === device.mac && 'active'"
                                @click="selectReceiver({type: 'bluetooth', device: device}); showReceiverDropdown = false"
                                :title="device.name">
                                üì± <span x-text="device.name"></span>
                            </button>
                        </template>
                        <template x-for="device in airplayDevices" :key="device.address">
                            <button class="dropdown-item" :class="selectedReceiver?.type === 'airplay' && selectedReceiver?.device?.address === device.address && 'active'"
                                @click="selectReceiver({type: 'airplay', device: device}); showReceiverDropdown = false"
                                :title="device.name">
                                üéµ <span x-text="device.name"></span>
                            </button>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Device List Panel -->
            <div class="device-list-panel">
                <h3>Available Devices</h3>

                <!-- Local Speaker -->
                <div class="device-group">
                    <div class="device-group-title">Local Speaker</div>
                    <div class="device-item" :class="selectedReceiver?.type === 'local' && 'active'"
                         @click="selectReceiver({type: 'local', device: null})">
                        <span class="device-icon">üîä</span>
                        <span class="device-name">This Device</span>
                    </div>
                </div>

                <!-- Bluetooth Devices -->
                <div class="device-group">
                    <div class="device-group-title">Bluetooth Speakers</div>
                    <div x-show="bluetoothDevices.length === 0" class="no-devices-msg">No Bluetooth devices found</div>
                    <template x-for="device in bluetoothDevices" :key="device.mac">
                        <div class="device-item" :class="selectedReceiver?.type === 'bluetooth' && selectedReceiver?.device?.mac === device.mac && 'active'"
                             @click="selectReceiver({type: 'bluetooth', device: device})">
                            <span class="device-icon">üì±</span>
                            <span class="device-name" x-text="device.name"></span>
                        </div>
                    </template>
                    <button class="device-item" style="border-style: dashed;" @click="scanBluetoothDevices()" title="Scan for Bluetooth devices">
                        <span class="device-icon">üîç</span>
                        <span class="device-name">Scan for Devices</span>
                    </button>
                </div>

                <!-- Airplay Devices -->
                <div class="device-group">
                    <div class="device-group-title">Airplay Receivers</div>
                    <div x-show="airplayDevices.length === 0" class="no-devices-msg">No Airplay devices found</div>
                    <template x-for="device in airplayDevices" :key="device.address">
                        <div class="device-item" :class="selectedReceiver?.type === 'airplay' && selectedReceiver?.device?.address === device.address && 'active'"
                             @click="selectReceiver({type: 'airplay', device: device})">
                            <span class="device-icon">üéµ</span>
                            <span class="device-name" x-text="device.name"></span>
                        </div>
                    </template>
                    <button class="device-item" style="border-style: dashed;" @click="discoverAirplayDevices()" title="Discover Airplay devices">
                        <span class="device-icon">üîç</span>
                        <span class="device-name">Discover Devices</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Stations Section -->
        <div class="stations-section">
            <div class="section-header">
                <h2 class="section-title">
                    <span x-show="activeTab === 'search'">Search Results</span>
                    <span x-show="activeTab === 'popular'">Popular Stations</span>
                    <span x-show="activeTab === 'recent'">Recent Stations</span>
                    <span x-show="activeTab === 'favorites'">Favorite Stations</span>
                </h2>

                <!-- Tabs -->
                <div class="tabs-container">
                    <button class="tab-btn" :class="activeTab === 'search' && 'active'" @click="activeTab = 'search'">üîç Search</button>
                    <button class="tab-btn" :class="activeTab === 'popular' && 'active'" @click="activeTab = 'popular'; loadPopular()">1. Popular</button>
                    <button class="tab-btn" :class="activeTab === 'recent' && 'active'" @click="activeTab = 'recent'; loadRecent()">2. Recent</button>
                    <button class="tab-btn" :class="activeTab === 'favorites' && 'active'" @click="activeTab = 'favorites'; loadFavorites()">3. Favorites</button>
                </div>

                <!-- Search Input (only show in Search tab) -->
                <div class="filter-controls" x-show="activeTab === 'search'" style="margin-top: 5px;">
                    <input type="text" class="filter-select" style="flex: 1; max-width: none;" x-model="searchQuery" @keyup.debounce="search()" placeholder="üîç Search stations...">
                </div>

                <!-- Filters -->
                <div class="filter-controls" x-show="activeTab !== 'search'">
                    <span class="filter-label">Filter:</span>
                    <input type="text" class="filter-select" style="width: 140px;" x-model="filterRegex" @input="applyFilters()" placeholder="Regex pattern..." title="JavaScript regex to match station names">
                    <select class="filter-select" x-model="filterCountry" @change="applyFilters()">
                        <option value="">All Countries</option>
                        <option value="US">United States</option>
                        <option value="UK">United Kingdom</option>
                        <option value="DE">Germany</option>
                        <option value="FR">France</option>
                        <option value="CA">Canada</option>
                        <option value="AU">Australia</option>
                    </select>
                    <select class="filter-select" x-model="filterTopic" @change="applyFilters()">
                        <option value="">All Topics</option>
                        <option value="music">Music</option>
                        <option value="talk">Talk</option>
                        <option value="news">News</option>
                        <option value="rock">Rock</option>
                        <option value="jazz">Jazz</option>
                        <option value="pop">Pop</option>
                    </select>
                    <select class="filter-select" x-model="filterBitrate" @change="applyFilters()">
                        <option value="">All Bitrates</option>
                        <option value="64">64+ kbps</option>
                        <option value="128">128+ kbps</option>
                        <option value="192">192+ kbps</option>
                        <option value="256">256+ kbps</option>
                        <option value="320">320+ kbps</option>
                    </select>
                    <span class="filter-error" x-show="filterRegexError" style="color: #ff6b35; font-size: 0.75em; margin-left: 5px;" x-text="filterRegexError"></span>
                </div>
            </div>

            <!-- Loading State (Active API Call) -->
            <div x-show="loading" class="loading-spinner">
                <div class="spinner">‚ô™</div>
                <p style="color: #ff6b35; font-weight: 700; font-size: 1.1em;">Updating Stations</p>
                <p style="color: #a8a8a8; font-size: 0.95em;">Loading your favorite stations...</p>
            </div>

            <!-- Initial Load State (First Time) -->
            <div x-show="stations.length === 0 && !loading && isInitializing" class="empty-state">
                <div class="pulsing">‚ô™</div>
                <div class="empty-state-text">
                    <p style="color: #d4d4d4; font-weight: 700; font-size: 1.1em; margin-bottom: 10px;">Ready to Discover!</p>
                    <p>Stations will appear here once we've loaded them from our database. You can also search or browse.</p>
                </div>
            </div>

            <!-- Empty Search Results -->
            <div x-show="stations.length === 0 && !loading && !isInitializing" class="empty-state">
                <div class="empty-state-icon">üìª</div>
                <div class="empty-state-text">
                    <p style="color: #d4d4d4; font-weight: 700; font-size: 1.1em; margin-bottom: 10px;">Station Service Unavailable</p>
                    <p x-show="activeTab !== 'favorites'">The radio station database is currently unavailable. Please try again later or check your internet connection.</p>
                    <p x-show="activeTab === 'favorites'">No favorite stations saved yet. Add stations to your favorites to see them here.</p>
                </div>
            </div>

            <!-- Station Grid -->
            <div class="station-grid"
                 x-show="stations.length > 0"
                 @click="const target = $event.target.closest('.station-card') || $event.target;
                         const btn = target.querySelector ? target.querySelector('.station-action-btn') : $event.target.closest('.station-card')?.querySelector('.station-action-btn');
                         if (btn && btn.dataset.stationIndex !== undefined) {
                             const index = parseInt(btn.dataset.stationIndex);
                             if (!isNaN(index) && stations[index]) {
                                 playStation(stations[index]);
                             }
                         }">
                <template x-for="(station, index) in stations" :key="station.uuid">
                    <div class="station-card" style="cursor: pointer;">
                        <div class="station-icon">
                            <img :src="station.favicon || ''"
                                 :alt="station.name"
                                 @error="$el.style.display='none'; $el.parentElement.innerHTML=`<div class='station-icon-fallback'>üéµ</div>`"
                                 onerror="this.parentElement.innerHTML=`<div class='station-icon-fallback'>üéµ</div>`; this.style.display='none';"
                                 style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <h3 class="station-name" :title="station.name" x-text="station.name"></h3>
                        <p class="station-genre" x-text="(station.country || 'Unknown') + ' ‚Ä¢ ' + (station.codec || 'Unknown')"></p>
                        <div class="station-listeners" x-text="'üéß ' + station.bitrate + ' kbps'"></div>
                        <button class="station-action-btn"
                                :data-station-index="index"
                                x-text="currentStation?.uuid === station.uuid && isPlaying ? '‚è∏ Pause' : '‚ñ∂ Play'"></button>
                    </div>
                </template>
            </div>

            <!-- Pagination -->
            <div x-show="stations.length > 0 && totalStations > 20" style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                <button class="station-action-btn" style="width: auto; padding: 8px 20px;" @click="previousPage()" x-show="currentPage > 0">‚Üê Previous</button>
                <span style="color: #a8a8a8; display: flex; align-items: center; padding: 0 15px;" x-text="'Page ' + (currentPage + 1)"></span>
                <button class="station-action-btn" style="width: auto; padding: 8px 20px;" @click="nextPage()" x-show="(currentPage + 1) * 20 < totalStations">Next ‚Üí</button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-left">
            <span style="font-weight: 900; background: linear-gradient(135deg, #d4d4d4 0%, #ff6b35 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">cheeky</span>
        </div>
        <div class="footer-right">
            ¬© 2025 Cheeky Radio. All rights reserved.
        </div>
    </footer>

    <script>
        function radioApp() {
            return {
                // UI State
                loading: false,
                isInitializing: true,
                isPlaying: false,
                isFavorite: false,
                volume: 75,
                searchQuery: '',
                currentPage: 0,
                stations: [],
                totalStations: 0,
                currentStation: null,
                playProgress: 0,
                playbackTime: 0,
                playbackDuration: 0,
                favorites: [],
                recent: [],
                ws: null,
                activeTab: 'popular',
                filterCountry: '',
                filterTopic: '',
                filterBitrate: '',
                filterRegex: '',
                filterRegexError: '',
                allStations: [],

                // Receiver Selection
                showSettingsModal: false,
                showReceiverDropdown: false,
                bluetoothDevices: [],
                airplayDevices: [],
                selectedReceiver: { type: 'local', device: null },

                // Notifications
                notifications: [],
                notificationIdCounter: 0,

                // Utility: Format time
                formatTime(seconds) {
                    if (!seconds || isNaN(seconds)) return '0:00';
                    const hours = Math.floor(seconds / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    const secs = Math.floor(seconds % 60);
                    if (hours > 0) {
                        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    }
                    return `${minutes}:${secs.toString().padStart(2, '0')}`;
                },

                // Check if output devices are available
                hasOutputDevices() {
                    return this.bluetoothDevices.length > 0 || this.airplayDevices.length > 0;
                },

                // Show notification
                showNotification(title, message, type = 'info', icon = 'üì¢', duration = 5000) {
                    const id = this.notificationIdCounter++;
                    const notification = {
                        id,
                        title,
                        message,
                        type, // 'info', 'success', 'warning'
                        icon,
                        removing: false
                    };

                    console.log('[Cheeky] Showing notification:', notification);
                    this.notifications.push(notification);
                    console.log('[Cheeky] Notifications array:', this.notifications);

                    // Auto-dismiss after duration
                    if (duration > 0) {
                        setTimeout(() => {
                            this.removeNotification(id);
                        }, duration);
                    }
                },

                // Remove notification
                removeNotification(id) {
                    const notification = this.notifications.find(n => n.id === id);
                    if (notification) {
                        notification.removing = true;
                        // Wait for animation to complete before removing from array
                        setTimeout(() => {
                            const index = this.notifications.findIndex(n => n.id === id);
                            if (index > -1) {
                                this.notifications.splice(index, 1);
                            }
                        }, 300); // Match animation duration
                    }
                },

                // API Calls
                async apiCall(method, endpoint, body = null) {
                    try {
                        console.log(`%c[Cheeky] üåê ${method} /api${endpoint}`, 'color: #ff6b35; font-weight: bold;', body || '');
                        const options = {
                            method,
                            headers: { 'Content-Type': 'application/json' }
                        };
                        if (body) options.body = JSON.stringify(body);

                        const startTime = performance.now();
                        const response = await fetch(`/api${endpoint}`, options);
                        const endTime = performance.now();

                        if (!response.ok) throw new Error(`HTTP ${response.status}`);
                        const result = await response.json();
                        console.log(`%c[Cheeky] ‚úì ${method} ${response.status} (${(endTime - startTime).toFixed(0)}ms)`, 'color: #4CAF50; font-weight: bold;', result);
                        return result;
                    } catch (error) {
                        console.error(`%c[Cheeky] ‚ùå API Error: ${method} /api${endpoint}`, 'color: #f44336; font-weight: bold;', error);
                        return null;
                    }
                },

                // Load popular stations
                async loadPopular() {
                    this.loading = true;
                    this.searchQuery = '';
                    this.currentPage = 0;
                    this.filterCountry = '';
                    this.filterTopic = '';
                    this.filterBitrate = '';
                    this.filterRegex = '';
                    this.filterRegexError = '';
                    const result = await this.apiCall('GET', '/stations/popular?limit=20&offset=0');

                    if (result) {
                        this.allStations = result.stations;
                        this.stations = result.stations;
                        this.totalStations = result.total;
                    }
                    this.loading = false;
                    this.isInitializing = false;
                },

                async loadRecent() {
                    this.loading = true;
                    this.filterCountry = '';
                    this.filterTopic = '';
                    this.filterBitrate = '';
                    this.filterRegex = '';
                    this.filterRegexError = '';
                    // For now, use popular with a slight variation
                    // In a real app, this would fetch recently played stations
                    const result = await this.apiCall('GET', '/stations/popular?limit=20&offset=20');
                    if (result) {
                        this.allStations = result.stations;
                        this.stations = result.stations;
                        this.totalStations = result.total;
                    }
                    this.loading = false;
                },

                async loadFavorites() {
                    this.loading = true;
                    this.filterCountry = '';
                    this.filterTopic = '';
                    this.filterBitrate = '';
                    this.filterRegex = '';
                    this.filterRegexError = '';
                    // Show favorite stations or empty if none
                    this.allStations = this.favorites;
                    this.stations = this.favorites;
                    this.totalStations = this.favorites.length;
                    this.loading = false;
                },

                applyFilters() {
                    // Filter stations based on selected filters
                    let filtered = this.allStations;
                    this.filterRegexError = '';

                    // Apply regex filter
                    if (this.filterRegex.trim()) {
                        try {
                            // Create regex with case-insensitive flag
                            const regex = new RegExp(this.filterRegex, 'i');
                            filtered = filtered.filter(s => {
                                // Match against station name, country, codec, and tags
                                const name = s.name || '';
                                const country = s.country || '';
                                const codec = s.codec || '';
                                const tags = (s.tags || []).join(' ');
                                const searchText = `${name} ${country} ${codec} ${tags}`;
                                return regex.test(searchText);
                            });
                        } catch (error) {
                            // Show regex error
                            this.filterRegexError = 'Invalid regex: ' + error.message;
                            return;
                        }
                    }

                    // Apply topic filter
                    if (this.filterTopic) {
                        filtered = filtered.filter(s => {
                            const tags = (s.tags || []).join(' ').toLowerCase();
                            return tags.includes(this.filterTopic.toLowerCase());
                        });
                    }

                    // Apply bitrate filter
                    if (this.filterBitrate) {
                        const minBitrate = parseInt(this.filterBitrate);
                        filtered = filtered.filter(s => (s.bitrate || 0) >= minBitrate);
                    }

                    this.stations = filtered;
                    this.totalStations = filtered.length;
                },

                // Search stations
                async search() {
                    if (!this.searchQuery.trim()) {
                        await this.loadPopular();
                        return;
                    }

                    this.loading = true;
                    this.currentPage = 0;
                    const result = await this.apiCall('GET', `/stations/search?q=${encodeURIComponent(this.searchQuery)}&limit=20&offset=0`);

                    if (result) {
                        this.stations = result.stations;
                        this.totalStations = result.total;
                    }
                    this.loading = false;
                    this.isInitializing = false;
                },

                // Play station
                async playStation(station) {
                    if (this.currentStation?.uuid === station.uuid) {
                        console.log('%c‚ñ∂ Toggling playback for current station', 'color: #00BCD4;');
                        this.togglePlay();
                        return;
                    }

                    console.log(`%c‚ñ∂ Playing Station: ${station.name}`, 'color: #4CAF50; font-weight: bold;', station);
                    const result = await this.apiCall('POST', '/player/play', {
                        station_uuid: station.uuid,
                        stream_url: station.url,
                        station_name: station.name,
                        station_favicon: station.favicon
                    });

                    if (result) {
                        this.currentStation = station;
                        this.isPlaying = true;
                        this.checkFavorite();
                        console.log('%c‚úì Now playing:', 'color: #4CAF50;', station.name);
                    }
                },

                // Play/Pause
                async togglePlay() {
                    if (!this.currentStation) return;
                    const endpoint = this.isPlaying ? '/player/pause' : '/player/resume';
                    const action = this.isPlaying ? '‚è∏ Pausing' : '‚ñ∂ Resuming';
                    console.log(`%c${action}: ${this.currentStation.name}`, 'color: #FF9800;');
                    // Don't manually toggle isPlaying - let WebSocket update handle it
                    // This prevents race conditions and ensures UI matches backend state
                    await this.apiCall('POST', endpoint);
                },

                // Next/Previous
                async nextStation() {
                    if (this.stations.length === 0) return;
                    const currentIndex = this.stations.findIndex(s => s.uuid === this.currentStation?.uuid);
                    const nextIndex = (currentIndex + 1) % this.stations.length;
                    await this.playStation(this.stations[nextIndex]);
                },

                async previousStation() {
                    if (this.stations.length === 0) return;
                    const currentIndex = this.stations.findIndex(s => s.uuid === this.currentStation?.uuid);
                    const prevIndex = currentIndex <= 0 ? this.stations.length - 1 : currentIndex - 1;
                    await this.playStation(this.stations[prevIndex]);
                },

                // Volume
                setVolume(event) {
                    const rect = event.currentTarget.getBoundingClientRect();
                    const percent = ((event.clientX - rect.left) / rect.width) * 100;
                    this.volume = Math.max(0, Math.min(100, Math.round(percent)));
                    this.apiCall('POST', '/player/volume', { volume: this.volume });
                },

                // Progress Seeking
                seekPlayback(event) {
                    if (this.playbackDuration === 0) return;
                    const rect = event.currentTarget.getBoundingClientRect();
                    const percent = ((event.clientX - rect.left) / rect.width) * 100;
                    const time = (percent / 100) * this.playbackDuration;
                    this.apiCall('POST', '/player/seek', { position: time });
                },

                // Favorites
                async toggleFavorite(station) {
                    if (!station) return;
                    if (this.isFavorite) {
                        await this.apiCall('POST', `/favorites/remove`, { uuid: station.uuid });
                    } else {
                        await this.apiCall('POST', `/favorites/add`, {
                            uuid: station.uuid,
                            name: station.name,
                            url: station.url,
                            favicon: station.favicon
                        });
                    }
                    this.checkFavorite();
                },

                checkFavorite() {
                    this.isFavorite = this.favorites.some(f => f.uuid === this.currentStation?.uuid);
                },

                // Pagination
                async nextPage() {
                    this.currentPage++;
                    const offset = this.currentPage * 20;
                    const endpoint = this.searchQuery
                        ? `/stations/search?q=${encodeURIComponent(this.searchQuery)}&limit=20&offset=${offset}`
                        : `/stations/popular?limit=20&offset=${offset}`;
                    const result = await this.apiCall('GET', endpoint);
                    if (result) {
                        this.stations = result.stations;
                    }
                },

                async previousPage() {
                    this.currentPage = Math.max(0, this.currentPage - 1);
                    const offset = this.currentPage * 20;
                    const endpoint = this.searchQuery
                        ? `/stations/search?q=${encodeURIComponent(this.searchQuery)}&limit=20&offset=${offset}`
                        : `/stations/popular?limit=20&offset=${offset}`;
                    const result = await this.apiCall('GET', endpoint);
                    if (result) {
                        this.stations = result.stations;
                    }
                },

                // Receiver Management
                async scanBluetoothDevices() {
                    console.log('[Cheeky] Scanning for Bluetooth devices...');
                    const result = await this.apiCall('POST', '/bluetooth/scan');
                    if (result) {
                        // Load devices after scan
                        setTimeout(() => this.loadBluetoothDevices(), 2000);
                    }
                },

                async loadBluetoothDevices() {
                    const result = await this.apiCall('GET', '/bluetooth/devices');
                    if (result) {
                        this.bluetoothDevices = result.devices || [];
                    }
                },

                async discoverAirplayDevices() {
                    const result = await this.apiCall('GET', '/airplay/devices');
                    if (result) {
                        this.airplayDevices = result.devices || [];
                    }
                },

                async selectReceiver(receiver) {
                    this.selectedReceiver = receiver;

                    // Connect to selected receiver
                    if (receiver.type === 'bluetooth' && receiver.device) {
                        await this.apiCall('POST', '/bluetooth/connect', { mac: receiver.device.mac });
                    } else if (receiver.type === 'airplay' && receiver.device) {
                        await this.apiCall('POST', '/airplay/connect', {
                            address: receiver.device.address,
                            port: receiver.device.port || 5000,
                            name: receiver.device.name
                        });
                    } else if (receiver.type === 'local') {
                        // Disconnect from external receivers
                        if (this.selectedReceiver.type === 'bluetooth') {
                            await this.apiCall('POST', '/bluetooth/disconnect', { mac: this.selectedReceiver.device.mac });
                        } else if (this.selectedReceiver.type === 'airplay') {
                            await this.apiCall('POST', '/airplay/disconnect');
                        }
                    }
                },

                async loadAllReceivers() {
                    await this.loadBluetoothDevices();
                    await this.discoverAirplayDevices();
                },

                // WebSocket for real-time updates
                connectWebSocket() {
                    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                    this.ws = new WebSocket(`${protocol}//${window.location.host}/ws`);

                    this.ws.onopen = () => {
                        console.log('%c[Cheeky] WebSocket connected - syncing state', 'color: #4CAF50;');
                        // Request current state when connected
                        this.syncState();
                    };

                    this.ws.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            console.log('%c[Cheeky] WebSocket message:', 'color: #00BCD4;', data);

                            // Handle different message types
                            if (data.type === 'playback_status') {
                                const wasPlaying = this.isPlaying;
                                this.isPlaying = data.status === 'playing';

                                // Show notification on play/pause state changes
                                if (!wasPlaying && this.isPlaying) {
                                    // Started playing
                                    const stationName = data.station?.name || this.currentStation?.name || 'Unknown Station';
                                    this.showNotification(
                                        'Now Playing',
                                        stationName,
                                        'success',
                                        '‚ñ∂Ô∏è'
                                    );
                                } else if (wasPlaying && !this.isPlaying) {
                                    // Paused or stopped
                                    this.showNotification(
                                        'Playback Paused',
                                        'Playback has been paused',
                                        'info',
                                        '‚è∏Ô∏è'
                                    );
                                }

                                // Update current station if provided
                                if (data.station) {
                                    this.currentStation = data.station;
                                }
                            } else if (data.type === 'volume_change') {
                                this.volume = data.volume;
                            } else if (data.type === 'progress') {
                                this.playbackTime = data.position;
                                this.playbackDuration = data.duration;
                                this.playProgress = (this.playbackTime / this.playbackDuration) * 100;
                            } else if (data.type === 'airplay_connected') {
                                // Update selected receiver when Airplay connects
                                if (data.device) {
                                    this.selectedReceiver = {
                                        type: 'airplay',
                                        device: data.device
                                    };
                                    this.showNotification(
                                        'Airplay Connected',
                                        `Connected to ${data.device.name}`,
                                        'success',
                                        'üéµ'
                                    );
                                }
                            } else if (data.type === 'airplay_disconnected') {
                                // Reset to local speaker
                                this.selectedReceiver = { type: 'local', device: null };
                                this.showNotification(
                                    'Airplay Disconnected',
                                    'Switched to local speaker',
                                    'info',
                                    'üîä'
                                );
                            } else if (data.type === 'bluetooth_connected') {
                                // Update selected receiver when Bluetooth connects
                                if (data.device) {
                                    this.selectedReceiver = {
                                        type: 'bluetooth',
                                        device: data.device
                                    };
                                    this.showNotification(
                                        'Bluetooth Connected',
                                        `Connected to ${data.device.name}`,
                                        'success',
                                        'üì±'
                                    );
                                }
                            } else if (data.type === 'bluetooth_disconnected') {
                                // Reset to local speaker
                                this.selectedReceiver = { type: 'local', device: null };
                                this.showNotification(
                                    'Bluetooth Disconnected',
                                    'Switched to local speaker',
                                    'info',
                                    'üîä'
                                );
                            } else if (data.type === 'favorites_updated') {
                                // Reload favorites when they change
                                this.loadFavorites();
                            } else if (data.type === 'devices_updated') {
                                // Update device lists from background discovery
                                console.log('[Cheeky] ‚ö° devices_updated WebSocket message received:', data);

                                if (data.airplay_devices) {
                                    const oldCount = this.airplayDevices.length;
                                    console.log('[Cheeky] üìä Before update - oldCount:', oldCount, 'devices:', this.airplayDevices);

                                    this.airplayDevices = data.airplay_devices;
                                    const newCount = data.airplay_devices.length;

                                    console.log('[Cheeky] üìä After update - newCount:', newCount, 'devices:', this.airplayDevices);
                                    console.log(`%c[Cheeky] Devices updated: ${newCount} Airplay devices`, 'color: #00BCD4;');

                                    // Show notification if devices were discovered
                                    if (newCount > oldCount) {
                                        const diff = newCount - oldCount;
                                        console.log(`[Cheeky] üîî TRIGGERING notification: ${diff} new devices discovered`);
                                        this.showNotification(
                                            'Devices Discovered',
                                            `Found ${diff} new Airplay ${diff === 1 ? 'device' : 'devices'}`,
                                            'success',
                                            'üîç'
                                        );
                                    } else if (newCount < oldCount) {
                                        const diff = oldCount - newCount;
                                        console.log(`[Cheeky] üîî TRIGGERING notification: ${diff} devices removed`);
                                        this.showNotification(
                                            'Devices Changed',
                                            `${diff} Airplay ${diff === 1 ? 'device' : 'devices'} no longer available`,
                                            'warning',
                                            '‚ö†Ô∏è'
                                        );
                                    } else {
                                        console.log('[Cheeky] ‚ÑπÔ∏è No count change (oldCount === newCount), no notification');
                                    }
                                } else {
                                    console.log('[Cheeky] ‚ö†Ô∏è devices_updated message has no airplay_devices data');
                                }
                            }
                        } catch (e) {
                            console.error('[Cheeky] WebSocket parse error:', e);
                        }
                    };

                    this.ws.onclose = () => {
                        console.log('%c[Cheeky] WebSocket disconnected - reconnecting in 3s', 'color: #FF9800;');
                        setTimeout(() => this.connectWebSocket(), 3000);
                    };

                    this.ws.onerror = (error) => {
                        console.error('[Cheeky] WebSocket error:', error);
                    };
                },

                // Sync state from server (called when WebSocket connects)
                async syncState() {
                    try {
                        // Get current player status
                        const status = await this.apiCall('GET', '/player/status');
                        if (status) {
                            this.isPlaying = status.status === 'playing';
                            this.volume = status.volume;
                            this.currentStation = status.station;
                        }

                        // Get current output device status
                        const airplayStatus = await this.apiCall('GET', '/airplay/status');
                        if (airplayStatus && airplayStatus.connected) {
                            this.selectedReceiver = {
                                type: 'airplay',
                                device: airplayStatus.device
                            };
                        }

                        console.log('%c[Cheeky] ‚úì State synced', 'color: #4CAF50;');
                    } catch (e) {
                        console.error('[Cheeky] Failed to sync state:', e);
                    }
                },

                // Update progress (for local demo)
                updateProgress() {
                    if (this.isPlaying && this.playbackDuration > 0) {
                        this.playbackTime = Math.min(this.playbackTime + 0.1, this.playbackDuration);
                        this.playProgress = (this.playbackTime / this.playbackDuration) * 100;
                    }
                },

                // Init
                async init() {
                    console.log('%c[Cheeky] üéµ Initializing Radio Player v1.1.0...', 'color: #ff6b35; font-size: 14px; font-weight: bold;');
                    console.log('Loading popular stations and receivers...');

                    // Test notification on load
                    this.showNotification('Welcome!', 'Radio player is ready', 'success', 'üéµ', 3000);

                    await this.loadPopular();
                    await this.loadAllReceivers();
                    this.connectWebSocket();
                    console.log('%c[Cheeky] ‚úì Radio Player Ready!', 'color: #4CAF50; font-size: 12px; font-weight: bold;');
                    setInterval(() => this.updateProgress(), 100);
                }
            }
        }

        // Let Alpine handle initialization naturally
    </script>
</body>
</html>
